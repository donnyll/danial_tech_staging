<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Tanjung Homemade Creative â€” Gas Biz</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header class="app-header">
        <h2 style="margin:0;">Gas Biz System</h2>
        <div style="display: flex; gap: 8px;">
            <button id="toggleRecordsBtn" class="secondary">Sembunyi Rekod</button>
            <button id="themeBtn" class="theme-toggle" title="Tukar tema">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>
        </div>
    </header>

    <main>
        <div class="summary-bar" id="summaryBar"></div>

        <section id="view-stok" class="view active">
            <form class="card" id="addStockForm">
                <h3>Tambah Stok Gas</h3>
                <div class="form-group"><label for="stDate">Tarikh</label><input type="date" id="stDate"></div>
                <div class="form-group"><label for="stNote">Nota (cth: Bil Lori)</label><input id="stNote" placeholder="Wajib diisi"></div>
                <div class="form-group"><label for="stQ14">Jumlah Tong 14KG</label><input type="number" id="stQ14" min="0" value=""></div>
                <div class="form-group"><label for="stC14">Harga Modal / Tong 14KG (RM)</label><input type="number" id="stC14" min="0" step="0.01" value=""></div>
                <div class="form-group"><label for="stQ12">Jumlah Tong 12KG</label><input type="number" id="stQ12" min="0" value=""></div>
                <div class="form-group"><label for="stC12">Harga Modal / Tong 12KG (RM)</label><input type="number" id="stC12" min="0" step="0.01" value=""></div>
                <div class="form-group"><label for="stQI">Jumlah Tong Industri</label><input type="number" id="stQI" min="0" value=""></div>
                <div class="form-group"><label for="stCI">Harga Modal / Tong Industri (RM)</label><input type="number" id="stCI" min="0" step="0.01" value=""></div>
                <button type="button" id="addStock">Tambah Stok</button>
            </form>
            <form class="card" id="addExpenseForm">
                <h3>Tambah Modal Lain</h3>
                <div class="form-group"><label for="exDate">Tarikh</label><input type="date" id="exDate"></div>
                <div class="form-group">
                    <label for="exType">Jenis Modal</label>
                    <select id="exType"><option>Minyak Lori</option><option>Upah Kilang</option><option>Others</option></select>
                </div>
                <div class="form-group"><label for="exAmt">Jumlah (RM)</label><input type="number" id="exAmt" step="0.01" min="0"></div>
                <div class="form-group"><label for="exNote">Nota</label><input id="exNote"></div>
                <button type="button" id="addExpense">Tambah Modal</button>
            </form>
            <h3 class="record-title">Rekod Stok Gas</h3>
            <div id="stockList" class="record-list"></div>
            <h3 class="record-title" style="margin-top: 20px;">Rekod Modal Lain</h3>
            <div id="expList" class="record-list"></div>
        </section>

        <section id="view-jualan" class="view">
             <form class="card" id="addSaleForm">
                <h3>Rekod Jualan Baru</h3>
                <div class="form-group"><label for="slDate">Tarikh</label><input type="date" id="slDate"></div>
                <div class="form-group">
                    <label for="slClient">Pelanggan</label>
                    <div class="search-container">
                        <input type="text" id="slClient" placeholder="Cari atau pilih pelanggan..." autocomplete="off">
                        <div id="client-search-results" class="search-results"></div>
                    </div>
                </div>
                <div class="form-group"><label for="slQ14">Total Tong 14KG</label><input type="number" id="slQ14" min="0" value=""></div>
                <div class="form-group"><label for="slPaid14">Tong Dibayar 14KG</label><input type="number" id="slPaid14" min="0" value=""></div>

                <details style="margin-bottom: 14px; border: 1px dashed var(--border); border-radius: 8px;">
                    <summary style="font-size: 0.9rem; color: var(--text-link); cursor: pointer; padding: 10px;">+ Tambah Jualan Tong 12KG / Industri</summary>
                    <div style="padding: 0 10px 10px 10px; margin-top: 10px;">
                        <div class="form-group"><label for="slQ12">Total Tong 12KG</label><input type="number" id="slQ12" min="0" value=""></div>
                        <div class="form-group"><label for="slPaid12">Tong Dibayar 12KG</label><input type="number" id="slPaid12" min="0" value=""></div>
                        <div class="form-group"><label for="slQI">Total Tong Industri</label><input type="number" id="slQI" min="0" value=""></div>
                        <div class="form-group"><label for="slPaidI">Tong Dibayar Industri</label><input type="number" id="slPaidI" min="0" value=""></div>
                    </div>
                </details>

                <div class="form-group"><label for="slPayType">Jenis Pembayaran</label><select id="slPayType"><option>Cash</option><option>Transfer</option><option>Hutang</option></select></div>
                <div class="form-group"><label for="slRemark">Remark</label><input id="slRemark"></div>
                <div id="slCalc" class="note" style="background: var(--surface-2); padding: 10px; border-radius: 8px; margin-bottom: 16px;"></div>
                <button type="button" id="addSale">Tambah Jualan</button>
             </form>
             <form class="card" id="payDebtForm">
                <h3>Bayar Hutang</h3>
                <div class="form-group">
                    <label for="debtClient">Pelanggan Berhutang</label>
                    <div class="search-container">
                        <input type="text" id="debtClient" placeholder="Cari pelanggan berhutang..." autocomplete="off">
                        <div id="debt-client-search-results" class="search-results"></div>
                    </div>
                </div>
                <div id="debtInfo" class="note" style="background: var(--surface-2); padding: 10px; border-radius: 8px; margin-bottom: 16px;">Pilih pelanggan untuk lihat baki hutang.</div>
                <div class="form-group"><label for="payQ14">Tong 14KG Dibayar</label><input type="number" id="payQ14" min="0" value=""></div>
                <div class="form-group"><label for="payQ12">Tong 12KG Dibayar</label><input type="number" id="payQ12" min="0" value=""></div>
                <div class="form-group"><label for="payQI">Tong Industri Dibayar</label><input type="number" id="payQI" min="0" value=""></div>
                <div class="form-group"><label for="debtMethod">Kaedah Bayaran</label><select id="debtMethod"><option>Cash</option><option>Transfer</option><option>Other</option></select></div>
                <div class="form-group"><label for="payNote">Nota</label><input id="payNote"></div>
                <button type="button" id="btnPayDebt">Sahkan Bayaran</button>
            </form>
            <h3 class="record-title">Rekod Jualan</h3>
            <div id="salesList" class="record-list"></div>
        </section>

        <section id="view-admin" class="view">
            <div id="adminLogin" class="card">
                <h3>Log Masuk Admin</h3>
                <div class="form-group" style="display:flex; align-items:flex-end; gap:8px;">
                    <div style="flex:1;"><label for="adminPIN">PIN Admin</label><input id="adminPIN" type="password" placeholder="****"></div>
                    <button id="btnAdminLogin" style="width: auto; padding: 12px 20px;">Masuk</button>
                </div>
                <p class="note">PIN Lalai: <b></b>.</p>
            </div>
            <div id="adminArea" style="display: none;">
                <form class="card" id="addClientForm">
                    <h3>Urus Pelanggan</h3>
                    <div class="form-group"><label for="clName">Nama</label><input id="clName"></div>
                    <div class="form-group"><label for="clCat">Kategori</label><input id="clCat" placeholder="cth: Peruncit, Kedai Makan"></div>
                    <div class="form-group"><label for="clP14">Harga Jual 14KG (RM)</label><input type="number" id="clP14" step="0.01" min="0"></div>
                    <div class="form-group"><label for="clP12">Harga Jual 12KG (RM)</label><input type="number" id="clP12" step="0.01" min="0"></div>
                    <div class="form-group"><label for="clPI">Harga Jual Industri (RM)</label><input type="number" id="clPI" step="0.01" min="0"></div>
                    <button type="button" id="addClient">Tambah Pelanggan</button>
                    <details style="margin-top: 20px;">
                        <summary style="font-weight: 500; cursor:pointer;">Lihat Senarai Pelanggan</summary>
                        <div class="table-wrap" style="margin-top: 10px;"><table id="clientTable"><thead><tr><th>Nama</th><th>Kategori</th><th>Harga 14/12/I</th><th>Hutang (RM)</th><th>Aksi</th></tr></thead><tbody></tbody></table></div>
                    </details>
                </form>
                <div class="card">
                    <h3>Sejarah Pembayaran Hutang</h3>
                    <div class="table-wrap"><table id="payTable"><thead><tr><th>Tarikh</th><th>Pelanggan</th><th>Jumlah (RM)</th><th>Kaedah</th><th>Nota</th></tr></thead><tbody></tbody></table></div>
                </div>
                <form class="card" id="addPayrollForm">
                    <h3>Rekod Gaji Pekerja</h3>
                    <div class="form-group"><label for="pgDate">Tarikh</label><input type="date" id="pgDate"></div>
                    <div class="form-group"><label for="pgName">Nama Pekerja</label><input id="pgName"></div>
                    <div class="form-group"><label for="pgAmt">Jumlah (RM)</label><input type="number" id="pgAmt" step="0.01" min="0"></div>
                    <div class="form-group"><label for="pgNote">Nota</label><input id="pgNote"></div>
                    <button type="button" id="addPayroll">Tambah Gaji</button>
                    <details style="margin-top: 20px;">
                        <summary style="font-weight: 500; cursor:pointer;">Lihat Sejarah Gaji</summary>
                        <div class="table-wrap" style="margin-top: 10px;"><table id="payrollTable"><thead><tr><th>Tarikh</th><th>Nama</th><th>Jumlah</th><th>Nota</th><th>Aksi</th></tr></thead><tbody></tbody></table></div>
                    </details>
                </form>
                <div class="card">
                    <h3>Ringkasan & Laporan</h3>
                    <div id="reportKPI" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;"></div>
                    <div class="divider"></div>
                    <p class="note">Eksport data dalam format CSV untuk simpanan atau analisa lanjut.</p>
                    <div class="btn-row" style="margin-top: 10px; display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                        <button type="button" id="exportSalesCsv" class="secondary">Jualan</button>
                        <button type="button" id="exportStocksCsv" class="secondary">Stok</button>
                        <button type="button" id="exportExpensesCsv" class="secondary">Belanja</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Tetapan & Data</h3>
                    <div class="form-group">
                        <label for="setPIN">Tukar PIN Admin</label>
                        <div style="display:flex; gap: 8px;">
                            <input id="setPIN" placeholder="PIN baru">
                            <button type="button" id="savePIN" style="width: auto;">Simpan</button>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <label style="font-weight: 600; color: var(--warn);">Operasi Data</label>
                    <p class="note">Hanya reset kiraan pada kad "Sold" di laman utama kepada 0. Data jualan tidak akan dipadam.</p>
                    <button type="button" id="resetCounterBtn" class="secondary" style="margin-top: 8px;">Reset Kiraan "Sold" Sahaja</button>
                    <div class="divider"></div>
                    <label style="font-weight: 600; color: var(--danger);">Zon Bahaya</label>
                    <p class="note">Tindakan di bawah akan memadam data secara kekal dan tidak boleh diundur.</p>
                    <button type="button" id="resetAllSalesBtn" class="danger" style="margin-top: 8px;">Padam Semua Data Jualan</button>
                    <button type="button" id="deleteAllDataBtn" class="danger" style="margin-top: 8px;">PADAM SEMUA DATA SISTEM</button>
                </div>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <button class="nav-btn active" data-view="stok">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 9v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9"/><path d="M9 22V12h6v10"/><path d="M2 10.6L12 2l10 8.6"/></svg>
            <span>Stok</span>
        </button>
        <button class="nav-btn" data-view="jualan">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
            <span>Jualan</span>
        </button>
        <button class="nav-btn" data-view="admin">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            <span>Admin</span>
        </button>
    </nav>
    <div class="print-container"></div>
    <script src="script.js"></script>
</body>
</html>